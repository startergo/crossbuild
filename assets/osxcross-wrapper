#!/bin/sh

# Pass the command through to the matching binary in osxcross
# Extract the command name (last part of $0)
cmd=$(basename "$0")

# If called directly (as cc or gcc), use clang
if [ "$cmd" = "cc" ] || [ "$cmd" = "gcc" ]; then
    cmd="clang"
fi

# Find the correct binary in osxcross path
# First, try with the exact triple + command
EXACT_DARWIN_VER=$(cat /usr/osxcross/darwin_version || echo "23.5")
TRIPLE_PREFIX=$(echo $CROSS_TRIPLE | sed -E 's/([^-]+)-(.*)/\1/')
EXACT_BIN="/usr/osxcross/bin/${CROSS_TRIPLE}-${cmd}"

# If exact match doesn't exist, try with pattern matching
if [ ! -f "$EXACT_BIN" ]; then
    FOUND_BIN=$(find /usr/osxcross/bin -name "${TRIPLE_PREFIX}-apple-darwin*-${cmd}" | head -1)
    if [ -n "$FOUND_BIN" ]; then
        EXACT_BIN="$FOUND_BIN"
    fi
fi

# Execute the command if it exists
if [ -f "$EXACT_BIN" ]; then
    exec "$EXACT_BIN" "$@"
else
    echo "Error: Could not find binary for $TRIPLE_PREFIX-apple-darwin*-$cmd"
    echo "Available binaries:"
    ls -la /usr/osxcross/bin | grep "$cmd" || echo "None found"
    exit 1
fi
